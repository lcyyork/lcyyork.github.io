---
layout: distill
title: "installing Psi4 and Forte"
date: 2024-09-29 10:00:00+0800
description: a step-by-step guide to installing Psi4 and Forte
tags: [ software, quantum chemistry ]
categories: tutorials

toc:
  - name: Update Ubuntu Packages
  - name: Install CUDA Toolkit (Optional)
  - name: Install Intel oneAPI (Optional)
  - name: Configure Python Environment
  - name: Install Forte (Non-developer)
  - name: Install Ambit (Developer)
  - name: Install block2-preview (Optional for DMRG)
  - name: Install Psi4 from Source (Developer)
  - name: Install Forte (Developer)
---

This tutorial provides a step-by-step guide for installing the quantum chemistry packages **Psi4** and **Forte** in Windows 11 WSL2.

- Psi4: https://github.com/psi4/psi4
- Forte: https://github.com/evangelistalab/forte

This guide heavily references from <a href="https://github.com/evangelistalab/forte/issues/277" target="_blank">Francesco‚Äôs psi4/ambit/forte setup (Mac BigSur 11.6.1, Dec. 2021)</a>

---

## 1. Update Ubuntu Packages

### 1.1 Launch WSL

In Windows PowerShell or CMD:

```
wsl
```

Enter root mode:

```bash
sudo -i
```

### 1.2 Change Ubuntu Mirror (Optional)

If network access is slow, consider switching to a faster mirror.

Backup:

```
cp /etc/apt/sources.list /etc/apt/sources.list.backup
```

Replace the content of `/etc/apt/sources.list` with a mirror matching your Ubuntu version.
<aside>
For example, <a href="https://mirrors.tuna.tsinghua.edu.cn" target="_blank">Tsinghua Open Source Mirror</a>
</aside>

### 1.3 Update Packages

```bash
apt update
apt upgrade
apt autoremove
```

Install development tools:

```bash
apt install build-essential gfortran
```

Install spf13-vim (optional):

```bash
curl https://j.mp/spf13-vim3 -L > spf13-vim.sh && sh spf13-vim.sh
```

---

## 2. Install CUDA Toolkit (Optional)

Requires NVIDIA driver installed in Windows.

Follow instructions from NVIDIA website.<d-footnote>https://developer.nvidia.com/cuda-downloads</d-footnote>

Example (WSL-Ubuntu, deb network):

```bash
wget https://developer.download.nvidia.com/compute/cuda/repos/wsl-ubuntu/x86_64/cuda-keyring_1.1-1_all.deb
sudo dpkg -i cuda-keyring_1.1-1_all.deb
sudo apt-get update
sudo apt-get -y install cuda-toolkit-12-6
```

Verify installation:

```bash
nvidia-smi
```

---

## 3. Install Intel oneAPI (Optional)

Install Intel Base Toolkit and HPC Toolkit via APT:<d-footnote>https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit-download.html</d-footnote>

```bash
sudo apt update
sudo apt install -y gpg-agent wget
wget -O- https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB | gpg ‚Äìdearmor | sudo tee /usr/share/keyrings/oneapi-archive-keyring.gpg > /dev/null
echo ‚Äúdeb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main‚Äù | sudo tee /etc/apt/sources.list.d/oneAPI.list
sudo apt update
sudo apt install intel-basekit
sudo apt install intel-hpckit
```

<aside>
A sucessful installation should generate the `/opt/intel/oneapi` folder.
</aside>

Set up the environment:

```bash
source /opt/intel/oneapi/setvars.sh
```

Optionally, add the following to `~/.bashrc` so that the variables are automatically loaded every time starting WSL:

```bash
. /opt/intel/oneapi/setvars.sh
```

---

## 4. Configure Python Environment

### 4.1 Install Miniconda

```bash
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
```

### 4.2 Add conda-forge Channel

Edit `~/.condarc`:

```yaml
channels:
  - conda-forge
  - defaults
```

<aside>
It is also possible to specify channel mirrors, e.g., <a href="https://mirror.tuna.tsinghua.edu.cn/help/anaconda" target="_blank">Anaconda ËΩØ‰ª∂‰ªìÂ∫ì</a>
</aside>

### 4.3 Create forte.yml

```yaml
name: forte
dependencies:
  - python=3.12
  - pip
  - cmake
  - clang-format
  - numpy
  - scipy
  - boost
  - hdf5
  - yaml
  - jupyter
  - eigen
  - pytest
  - pydantic
  - pint
  - pybind11
  - pyyaml
  - pythreejs
  - libint
```

Create environment:

```bash
conda env create -f forte.yml
conda activate forte
```

Add activation command `conda activate forte` to `~/.bashrc` if desired.

---

## 5. Install Forte (Non-developer)

The easiest way to install forte is from `conda`:

```bash
conda install conda-forge::forte
```

Developers may need to compile Forte manually (see below).

---

## 6. Install Ambit

```bash
git clone https://github.com/jturney/ambit.git
cd ambit
mkdir build && cd build
cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/src/ambit-install \
         -DCMAKE_C_COMPILER=icx \
         -DCMAKE_CXX_COMPILER=icpx
make -j20
make install
```

<aside>
Please search for 'ghproxy' on the internet if you encounter internet issue when cloning the repository.
</aside>

Add to `~/.bashrc`:

```bash
export PYTHONPATH=$HOME/src/ambit-install/lib:$PYTHONPATH
export AMBITPATH=$HOME/src/ambit-install
```

---

## 7. Install block2-preview (Optional for DMRG)

```bash
git clone https://github.com/block-hczhai/block2-preview.git
cd block2-preview
mkdir build && cd build
cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/src/block2-install \
         -DUSE_MKL=ON \
         -DBUILD_CLIB=ON \
         -DLARGE_BOND=ON \
         -DMPI=OFF \
         -DCMAKE_C_COMPILER=icx \
         -DCMAKE_CXX_COMPILER=icpx
make -j20
make install
```

<aside>
If you see the error message `icpx: error: Use of ‚Äò-qopenmp‚Äô recommended over ‚Äò-fopenmp‚Äô [-Werror,-Wrecommended-option]`,
you may replace `‚Äìfopenmp` to `-qopenmp` in `CMakeLists.txt`.
</aside>

---

## 8. Install Psi4 from Source

Install dependencies:

```bash
conda install libxc libecpint dkh gau2grid qcelemental qcengine optking
```

Clone source:

```bash
git clone https://github.com/psi4/psi4.git
cd psi4
mkdir build
cd build
```

Configure:

```bash
cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/src/psi4-install \
         -DENABLE_dkh=ON \
         -DENABLE_ambit=ON \
         -DENABLE_ecpint=ON \
         -DMAX_AM_ERI=8 \
         -Dpsi4_CXX_STANDARD=20 \
         -DCMAKE_CXX_STANDARD=20 \
         -Dambit_DIR=$HOME/src/ambit-install/share/cmake/ambit \
         -DCMAKE_C_COMPILER=icx \
         -DCMAKE_CXX_COMPILER=icpx \
         -DCMAKE_Fortran_COMPILER=gfortran
```

Compile:

```bash
make -j20
make install
```

If Eigen error `fatal error: ‚Äòeigen3/Eigen/Core‚Äô file not found` occurs,
you may install a new eigen via `sudo apt install libeigen3-dev`.
Then, remove `CMakeCache.txt` and `CMakeFiles` and reconfigure with `-DEigen3_DIR=/usr/share/eigen3/cmake`.

Add environment variables to `~/.bashrc`:<d-footnote>Please check https://psicode.org/psi4manual/1.1.0/build_planning</d-footnote>

```bash
export PSI4OBJ=$HOME/src/psi4/build
export PSI4INS=$HOME/src/psi4-install
export PSIDATADIR=$PSI4INS/share/psi4
export PSI_SCRATCH=/tmp/scratch/psi4
export PYTHONPATH=$PSI4OBJ/stage/lib:$PYTHONPATH
export PATH=$PSI4OBJ/stage/bin:$PATH
```

Test:

```bash
cd $HOME/src/psi4/tests/scf1
psi4
```

---

## 9. Install Forte (Developer Build)

### 9.1 Clone:

```bash
git clone https://github.com/evangelistalab/forte.git
cd forte
```

### 9.2 Compile

#### 9.2.1 Compile via `setup.py` (Recommended)

Create `setup.cfg`:

```
[CMakeBuild]
ambitpath=$HOME/src/ambit-install
cmake_config_options=-DCMAKE_BUILD_TYPE=Debug -DENABLE_block2=ON -DCMAKE_PREFIX_PATH=$HOME/src/block2-install/share/cmake/block2
```

You need to replace `$HOME` to full path in the above lines.

Then execute:

```bash
python setup.py develop
```

#### 9.2.2 Manual CMake build using `psi4 --plugin-compile`

Create `compile-forte.sh`:

```
#! /bin/bash
# Modify the following parameters
ambit_dir=$HOME/src/ambit-install/share/cmake/ambit
block2_dir=$HOME/src/block2-install/share/cmake/block2
srcdir=$HOME/src/forte
build_type=Debug
# Run cmake
cd $srcdir
rm -rf CMakeFiles CMakeCache.txt cmake_install.cmake
cmake_psi4=`psi4 ‚Äìplugin-compile`
$cmake_psi4 -Dambit_DIR=$ambit_dir -DCMAKE_BUILD_TYPE=$build_type -DMAX_DET_ORB=128 -DENABLE_block2=ON -Dblock2_DIR=$block2_dir
# Compile
make -j20
```

<aside>
<p>Please replace relevant paths.</p>
</aside>

Execute:

```bash
bash compile-forte.sh
```

Set environment variables in `~/.bashrc`:

```
PYTHONPATH=$HOME/src/forte:$PYTHONPATH
```

### 9.3 Test

```bash
cd $HOME/src/forte/tests/method
python run_forte_tests.py --type short
```

üéâ Hooray! You compiled Forte successfully!
